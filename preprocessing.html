<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Doxygen: Preprocessing</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="doxygen_manual.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Doxygen
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('preprocessing.html','');});
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">预处理 </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>用来作为doxygen输入的源文件可以被doxygen内置的C预处理器解析。</p>
<p>默认情况下，doxygen只做部分预处理。也就是说，它计算条件编译语句(如#if)并计算宏定义，但不执行宏展开。</p>
<p>加如你有以下代码片段</p><pre class="fragment">#define VERSION 200
#define CONST_STRING const char *

#if VERSION &gt;= 200
  static CONST_STRING version = "2.xx";
#else
  static CONST_STRING version = "1.xx";
#endif
</pre><p>默认情况下，doxygen会将以下内容提供给它的解析器: </p>
<pre class="fragment">#define VERSION
#define CONST_STRING

  static CONST_STRING version = "2.xx";
</pre><p>您可以通过在配置文件中将 <a class="el" href="config.html#cfg_enable_preprocessing">ENABLE_PREPROCESSING</a> 
	设置为<code> NO</code> 
	<span class="tgt" data-group="0-0" data-section="0" data-sentence="0" style="box-sizing: border-box; min-height: 26px; line-height: 25.987503051757813px; color: rgb(51, 51, 51); font-family: Arial, 'Microsoft YaHei', '\\5FAE软雅黑', '\\5B8B体', 'Malgun Gothic', Meiryo, sans-serif; font-size: 13.600001335144043px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(247, 248, 250);">
	来禁用所有预处理。</span><span class="tgt" data-group="0-1" data-section="0" data-sentence="1" style="box-sizing: border-box; min-height: 26px; line-height: 25.987503051757813px; color: rgb(51, 51, 51); font-family: Arial, 'Microsoft YaHei', '\\5FAE软雅黑', '\\5B8B体', 'Malgun Gothic', Meiryo, sans-serif; font-size: 13.600001335144043px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(247, 248, 250);">在这种情况下，doxygen将读取两个语句，即:</span></p>
<pre class="fragment">  static CONST_STRING version = "2.xx";
  static CONST_STRING version = "1.xx";
</pre><p>如果希望展开 <code>CONST_STRING</code> 宏，应该将配置文件中的 <a class="el" href="config.html#cfg_macro_expansion">MACRO_EXPANSION</a> 
	标记设置为 <code>YES。则预处理后的结果为:</code></p>
<pre class="fragment">#define VERSION
#define CONST_STRING

  static const char * version = "2.xx";
</pre><p>
	请注意，doxygen现在将展开所有宏定义(如果需要，将递归地展开)，有些展开可能没必要。因此，doxygen还允许您仅展开您显式指定的那些定义。为此，您必须将<a class="el" href="config.html#cfg_expand_only_predef">EXPAND_ONLY_PREDEF</a> 
	记设置为 <code>YES</code> 并在 <a class="el" href="config.html#cfg_predefined">PREDEFINED</a> 
	或 <a class="el" href="config.html#cfg_expand_as_defined">EXPAND_AS_DEFINED</a> 
	标记之后指定宏定义。<br  />
</p>
<p>在处理Microsoft:<code>__declspec的语言扩展时，通常需要预处理程序的帮助。同样的道理也适用于GNU的</code> <code>__attribute__</code> 
扩展。下面是一个示例函数。</p>
<pre class="fragment">extern "C" void __declspec(dllexport) ErrorMsg( String aMessage,...);
</pre><p>当什么都不做时，doxygen就会感到困惑，把__declspec看成某种函数。为了更好的使用doxygen，通常使用以下预处理设置:</p>
<pre class="fragment">ENABLE_PREPROCESSING   = YES
MACRO_EXPANSION        = YES
EXPAND_ONLY_PREDEF     = YES
PREDEFINED             = __declspec(x)=
</pre><p> <br  />
</p>
<p>这将确保在doxygen解析源代码之前删除 __declspec(dllexport)。</p>
<p>类似的设置可以用于从输入中删除_attribute__表达式:</p>
<pre class="fragment">ENABLE_PREPROCESSING   = YES
MACRO_EXPANSION        = YES
EXPAND_ONLY_PREDEF     = YES
PREDEFINED             = __attribute__(x)=
</pre><p> <br  />
</p>
<p>对于一个更复杂的示例，假设您有一个名为IUnknown的抽象基类的以下模糊代码片段:</p>
<pre class="fragment">/*! A reference to an IID */
#ifdef __cplusplus
#define REFIID const IID &amp;
#else
#define REFIID const IID *
#endif


/*! The IUnknown interface */
DECLARE_INTERFACE(IUnknown)
{
  STDMETHOD(HRESULT,QueryInterface) (THIS_ REFIID iid, void **ppv) PURE;
  STDMETHOD(ULONG,AddRef) (THIS) PURE;
  STDMETHOD(ULONG,Release) (THIS) PURE;
};
</pre><p>如果没有宏展开，doxygen会很混乱，但是我们可能不想展开REFIID宏，因为它是文档化的，并且读取文档的用户应该在实现接口时使用它。</p>
<p>通过在配置文件中设置以下内容:</p>
<pre class="fragment">ENABLE_PREPROCESSING = YES
MACRO_EXPANSION      = YES
EXPAND_ONLY_PREDEF   = YES
PREDEFINED           = "DECLARE_INTERFACE(name)=class name" \
                       "STDMETHOD(result,name)=virtual result name" \
                       "PURE= = 0" \
                       THIS_= \
                       THIS= \
               __cplusplus
</pre><p>我们可以确保将正确的结果提供给doxygen的解析器:</p><pre class="fragment">/*! A reference to an IID */
#define REFIID

/*! The IUnknown interface */
class  IUnknown
{
  virtual  HRESULT   QueryInterface ( REFIID iid, void **ppv) = 0;
  virtual  ULONG   AddRef () = 0;
  virtual  ULONG   Release () = 0;
};
</pre><p><a class="el" href="config.html#cfg_predefined">注意，PREDEFINED</a> 
	标记接受函数，如宏定义(如<code>DECLARE_INTERFACE</code> )、普通宏替换(如 <code>PURE</code> 和 <code>THIS)和扁平定义(如</code> <code>__cplusplus</code>).</p>
<p>
还请注意，通常由预处理程序自动定义的预处理程序定义(如cplusplus)必须由doxygen的解析器手动定义(之所以这样做，是因为这些定义通常是特定于平台/编译器的)。</p>
<p>在某些情况下，您可能希望用其他东西替换宏名或函数，而不会将结果暴露给进一步的宏替换。可以这样做，但是要使用:=操作符而不是=</p>
<p>举个例子，假设我们有下面这段代码:</p><pre class="fragment">#define QList QListT
class QListT
{
};
</pre><p>Then the only way to get doxygen interpret this as a class definition for class <code>QList</code> is to define: </p><pre class="fragment">PREDEFINED = QListT:=QList
</pre><p>那么，让doxygen将其解释为类QList的类定义的唯一方法是:</p>
<pre class="fragment">PREDEFINED           = "DECLARE_INTERFACE(name)=class name" \
                       "STDMETHOD(result,name)=virtual result name" \
                       "PURE= = 0" \
                       THIS_= \
                       THIS= \
                       DECLARE_REGISTRY_RESOURCEID=// \
                       DECLARE_PROTECT_FINAL_CONSTRUCT=// \
                       "DECLARE_AGGREGATABLE(Class)= " \
                       "DECLARE_REGISTRY_RESOURCEID(Id)= " \
                       DECLARE_MESSAGE_MAP= \
                       BEGIN_MESSAGE_MAP=/* \
                       END_MESSAGE_MAP=*/// \
                       BEGIN_COM_MAP=/* \
                       END_COM_MAP=*/// \
                       BEGIN_PROP_MAP=/* \
                       END_PROP_MAP=*/// \
                       BEGIN_MSG_MAP=/* \
                       END_MSG_MAP=*/// \
                       BEGIN_PROPERTY_MAP=/* \
                       END_PROPERTY_MAP=*/// \
                       BEGIN_OBJECT_MAP=/* \
                       END_OBJECT_MAP()=*/// \
                       DECLARE_VIEW_STATUS=// \
                       "STDMETHOD(a)=HRESULT a" \
                       "ATL_NO_VTABLE= " \
                       "__declspec(a)= " \
                       BEGIN_CONNECTION_POINT_MAP=/* \
                       END_CONNECTION_POINT_MAP=*/// \
                       "DECLARE_DYNAMIC(class)= " \
                       "IMPLEMENT_DYNAMIC(class1, class2)= " \
                       "DECLARE_DYNCREATE(class)= " \
                       "IMPLEMENT_DYNCREATE(class1, class2)= " \
                       "IMPLEMENT_SERIAL(class1, class2, class3)= " \
                       "DECLARE_MESSAGE_MAP()= " \
                       TRY=try \
                       "CATCH_ALL(e)= catch(...)" \
                       END_CATCH_ALL= \
                       "THROW_LAST()= throw"\
                       "RUNTIME_CLASS(class)=class" \
                       "MAKEINTRESOURCE(nId)=nId" \
                       "IMPLEMENT_REGISTER(v, w, x, y, z)= " \
                       "ASSERT(x)=assert(x)" \
                       "ASSERT_VALID(x)=assert(x)" \
                       "TRACE0(x)=printf(x)" \
                       "OS_ERR(A,B)={ #A, B }" \
                       __cplusplus \
                       "DECLARE_OLECREATE(class)= " \
                       "BEGIN_DISPATCH_MAP(class1, class2)= " \
                       "BEGIN_INTERFACE_MAP(class1, class2)= " \
                       "INTERFACE_PART(class, id, name)= " \
                       "END_INTERFACE_MAP()=" \
                       "DISP_FUNCTION(class, name, function, result, id)=" \
                       "END_DISPATCH_MAP()=" \
                       "IMPLEMENT_OLECREATE2(class, name, id1, id2, id3, id4,\
                        id5, id6, id7, id8, id9, id10, id11)="
</pre><p>正如您所看到的，doxygen的预处理器非常强大，但是如果您想要更大的灵活性，您可以编写一个输入过滤器，并在 <a class="el" href="config.html#cfg_input_filter">INPUT_FILTER</a> 
	标记之后指定它。</p>
<p>如果你不确定doxygen预处理的效果，你可以如下运行doxygen:</p><pre class="fragment">  doxygen -d Preprocessor
</pre><p> 这将指示doxygen在预处理完成后将输入源转储到标准输出(提示:在配置文件中设置QUIET = YES和WARNINGS = 
	NO以禁用任何其他输出)。</p>
<p>
注意，并不是所有语言都进行预处理。对于使用“C”扫描程序(“java”、“d”和“php”除外)、Fortran文件(仅在扩展名至少包含一个大写字母字符的情况下)和vhdl文件，可以使用预处理。</p>
<p> 
转到 <a href="autolink.html">下一节</a> 或返回到 <a href="index.html">索引</a>。
 </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.16 </li>
  </ul>
</div>
</body>
</html>
